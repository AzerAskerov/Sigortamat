using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace SigortaYoxla
{
    /// <summary>
    /// Parametrize edilmiÅŸ messaging sistemi test proqramÄ±
    /// </summary>
    class ParametrizedMessagingProgram
    {
        static async Task Main(string[] args)
        {
            var messagingService = new MessagingService();
            
            Console.WriteLine("ğŸš€ Parametrize Messaging System Test");
            Console.WriteLine("=====================================\n");

            try
            {
                // Test 1: TÉ™k WhatsApp mesajÄ±
                await TestSingleWhatsAppMessage(messagingService);
                
                Console.WriteLine("\n" + "=".PadRight(50, '=') + "\n");
                
                // Test 2: MÃ¼xtÉ™lif kanallar
                await TestMultiChannelMessages(messagingService);
                
                Console.WriteLine("\n" + "=".PadRight(50, '=') + "\n");
                
                // Test 3: Bulk sÄ±ÄŸorta mesajlarÄ±  
                await TestBulkInsuranceMessages(messagingService);
                
                Console.WriteLine("\n" + "=".PadRight(50, '=') + "\n");
                
                // Test 4: Ä°nteraktiv test
                await InteractiveTest(messagingService);
            }
            catch (Exception ex)
            {
                Console.WriteLine($"âŒ Ãœmumi xÉ™ta: {ex.Message}");
            }
            
            Console.WriteLine("\nâœ… Test tamamlandÄ±! Enter basÄ±n...");
            Console.ReadLine();
        }

        /// <summary>
        /// Test 1: TÉ™k WhatsApp mesajÄ±
        /// </summary>
        static async Task TestSingleWhatsAppMessage(MessagingService service)
        {
            Console.WriteLine("ğŸ“± TEST 1: TÉ™k WhatsApp MesajÄ±");
            Console.WriteLine("------------------------------");
            
            var message = MessagingService.CreateTestMessage("Salam! Parametrize messaging sistem test âœ…");
            var result = await service.SendMessageAsync(message, "994553004661", ChannelEnum.WhatsApp);
            
            DisplayResult(result);
        }

        /// <summary>
        /// Test 2: MÃ¼xtÉ™lif kanallar
        /// </summary>
        static async Task TestMultiChannelMessages(MessagingService service)
        {
            Console.WriteLine("ğŸ“¢ TEST 2: MÃ¼xtÉ™lif Kanallar");
            Console.WriteLine("----------------------------");
            
            var message = MessagingService.CreateTestMessage("Multi-channel test mesajÄ±");
            
            // WhatsApp
            var whatsappResult = await service.SendMessageAsync(message, "994556875000", ChannelEnum.WhatsApp);
            DisplayResult(whatsappResult);
            
            await Task.Delay(1000);
            
            // SMS (simulasiya)
            var smsResult = await service.SendMessageAsync(message, "994555902205", ChannelEnum.SMS);
            DisplayResult(smsResult);
            
            await Task.Delay(1000);
            
            // Email (simulasiya)
            var emailMessage = new Message 
            { 
                Text = "Bu test email mÉ™tndir",
                Subject = "Test Email - Messaging System"
            };
            var emailResult = await service.SendMessageAsync(emailMessage, "test@example.com", ChannelEnum.Email);
            DisplayResult(emailResult);
        }

        /// <summary>
        /// Test 3: Bulk sÄ±ÄŸorta mesajlarÄ±
        /// </summary>
        static async Task TestBulkInsuranceMessages(MessagingService service)
        {
            Console.WriteLine("ğŸš— TEST 3: Bulk SÄ±ÄŸorta MesajlarÄ±");
            Console.WriteLine("----------------------------------");
            
            var bulkMessages = new List<(Message, string, ChannelEnum)>
            {
                (
                    MessagingService.CreateInsuranceMessage("90HB986", "âœ… SÄ±ÄŸorta: Aktiv\nğŸ“… Tarix: 15.08.2025\nğŸ¢ ÅirkÉ™t: ASCO"),
                    "994556875000", 
                    ChannelEnum.WhatsApp
                ),
                (
                    MessagingService.CreateInsuranceMessage("90HB987", "âŒ SÄ±ÄŸorta: Passiv\nâš ï¸ ZÉ™ruri: YenilÉ™yin!"),
                    "994555902205", 
                    ChannelEnum.WhatsApp
                ),
                (
                    MessagingService.CreateInsuranceMessage("90HB988", "âœ… SÄ±ÄŸorta: Aktiv\nğŸ“… Tarix: 20.09.2025\nğŸ¢ ÅirkÉ™t: ATÆÅGAH"),
                    "994553167781", 
                    ChannelEnum.WhatsApp
                )
            };
            
            var results = await service.SendBulkMessagesAsync(bulkMessages);
            
            Console.WriteLine($"\nğŸ“Š BULK NÆTÄ°CÆLÆR ({results.Count} mesaj):");
            Console.WriteLine("=".PadRight(40, '='));
            
            foreach (var result in results)
            {
                DisplayResult(result);
            }
        }

        /// <summary>
        /// Test 4: Ä°nteraktiv test
        /// </summary>
        static async Task InteractiveTest(MessagingService service)
        {
            Console.WriteLine("ğŸ® TEST 4: Ä°nteraktiv Test");
            Console.WriteLine("---------------------------");
            
            Console.Write("Telefon nÃ¶mrÉ™si daxil edin: ");
            var phoneNumber = Console.ReadLine();
            
            if (string.IsNullOrEmpty(phoneNumber))
            {
                Console.WriteLine("âŒ Telefon nÃ¶mrÉ™si daxil edilmÉ™di!");
                return;
            }
            
            Console.Write("Mesaj mÉ™tni daxil edin: ");
            var messageText = Console.ReadLine();
            
            if (string.IsNullOrEmpty(messageText))
            {
                messageText = "Ä°nteraktiv test mesajÄ±";
            }
            
            Console.WriteLine("\nKanalÄ± seÃ§in:");
            Console.WriteLine("1. WhatsApp");
            Console.WriteLine("2. SMS (simulasiya)");
            Console.WriteLine("3. Email (simulasiya)");
            Console.Write("SeÃ§im (1-3): ");
            
            var choice = Console.ReadLine();
            var channel = choice switch
            {
                "1" => ChannelEnum.WhatsApp,
                "2" => ChannelEnum.SMS,
                "3" => ChannelEnum.Email,
                _ => ChannelEnum.WhatsApp
            };
            
            var message = MessagingService.CreateTestMessage(messageText);
            var result = await service.SendMessageAsync(message, phoneNumber, channel);
            
            Console.WriteLine("\nğŸ“‹ Ä°nteraktiv Test NÉ™ticÉ™si:");
            DisplayResult(result);
        }

        /// <summary>
        /// NÉ™ticÉ™ni ekranda gÃ¶stÉ™rir
        /// </summary>
        static void DisplayResult(MessageResult result)
        {
            var status = result.Success ? "âœ…" : "âŒ";
            Console.WriteLine($"{status} {result.Channel}: {result.Recipient}");
            
            if (result.Success)
            {
                Console.WriteLine($"   ğŸ“¤ ID: {result.MessageId}");
                Console.WriteLine($"   ğŸ•’ Vaxt: {result.SentAt:HH:mm:ss}");
            }
            else
            {
                Console.WriteLine($"   âŒ XÉ™ta: {result.Error}");
            }
            
            Console.WriteLine();
        }
    }
}
